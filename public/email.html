<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open Sans">
<style>
body {
	font-family: 'Open Sans', serif;
	font-size: 15px;
}
form {
	position:fixed;
	bottom: 5px;
	right: 5px;
	border-left: 20px solid transparent;
}
#sendemail{
	width:500px; 
	min-height:200px; 
	border: 1px solid #fff;
	padding: 10px 10px 0 10px;
	font-family: 'Open Sans', serif;
	font-size: 15px;
	line-height: 26px;
}
</style>

</head>
<body>

<form action="sendemail" onsubmit="return false" method="post">
	<textarea id="sendemail"></textarea>
	<span id="count" style="display:block;">&nbsp</span>
</form>

<script type="text/javascript">
window.lastText = { since : Date.now(), timeChanged : false};
var _currentColor = $("form, #sendemail");

setInterval(function(){	
	if (window.lastText.timeChanged && (Date.now() - window.lastText.since)>1000){
		_currentColor.css("color", "#EEE");
		window.lastText.timeChanged = false;
	}	
}, 500);

	$(document).ready(function(){
		$("#sendemail").on("keydown", function(event){
			if (event.keyCode == 13){
				$.post( "/sendemail", { content: $("#sendemail").val().trim()})
					.done(function() {
						$("#sendemail").val('');
						$("#count").html("&nbsp");
					}).fail(function(err) {
						alert(err.responseText);
					});
			} else {
				var len = parseInt($("#sendemail").val().trim().length), numTexts = Math.ceil(len/112) || 1;
				$("#count").html(len==0?"&nbsp":numTexts*112 - len+ " ("+numTexts+")");
				if (!window.lastText.timeChanged) _currentColor.css("color", "black");
				window.lastText = { since : Date.now(), timeChanged : true};
			}
		}).focus();
	});
</script

</body>
</html>
